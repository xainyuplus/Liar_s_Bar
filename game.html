
è¿™ä¸ªæ˜¯AIç»™çš„ï¼Œæˆ‘è®¤ä¸ºå®ƒå†™çš„å‰ç«¯ä¸å¥½ï¼Œä½†æ˜¯å‡½æ•°å¯ä»¥å‚è€ƒï¼Œè¿˜åœ¨è‡ªå·±çš„indexé‡Œå†™å§
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éª—å­é…’é¦†</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/lobby.css">
    <link rel="stylesheet" href="css/game.css">
</head>
<body>
    <!-- è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="connection-indicator" class="connection-indicator disconnected">
        <span id="connection-text">è¿æ¥ä¸­...</span>
    </div>

    <!-- åœºæ™¯1: æ¬¢è¿/å¤§å…å±å¹• -->
    <div id="lobby-screen" class="screen active">
        <div class="lobby-container">
            <header class="game-header">
                <h1>ğŸº éª—å­é…’é¦†</h1>
                <p class="game-subtitle">ç­–ç•¥ã€æ¬ºéª—ä¸è¿æ°”çš„è¾ƒé‡</p>
            </header>
            
            <!-- æ¸¸æˆä»‹ç» -->
            <div class="game-intro">
                <div class="intro-section">
                    <h3>ğŸ¯ æ¸¸æˆè§„åˆ™</h3>
                    <ul>
                        <li>æ¯äºº5å¼ æ‰‹ç‰Œï¼ŒåŒ…å«Jã€Qã€Kå’Œä¸‡èƒ½çš„Joker</li>
                        <li>è½®æµå‡ºç‰Œå¹¶å£°ç§°æ˜¯"ç›®æ ‡ç‰Œ"ï¼Œå¯ä»¥è¯´è°ï¼</li>
                        <li>ä¸‹å®¶å¯ä»¥é€‰æ‹©ä¿¡ä»»æˆ–è´¨ç–‘</li>
                        <li>è´¨ç–‘å¤±è´¥è€…è¿›å…¥ä¿„ç½—æ–¯è½®ç›˜èµŒ</li>
                        <li>æœ€åå­˜æ´»çš„ç©å®¶è·èƒœ</li>
                    </ul>
                </div>
            </div>
            
            <!-- ç©å®¶ä¿¡æ¯è¾“å…¥ -->
            <div class="player-setup" id="player-setup">
                <div class="input-group">
                    <label for="player-name">ç©å®¶æ˜µç§°</label>
                    <input type="text" id="player-name" placeholder="è¾“å…¥æ‚¨çš„æ˜µç§°" maxlength="12">
                </div>
                
                <div class="room-options">
                    <button class="option-btn active" id="create-room-option" onclick="selectRoomOption('create')">
                        ğŸ  åˆ›å»ºæˆ¿é—´
                    </button>
                    <button class="option-btn" id="join-room-option" onclick="selectRoomOption('join')">
                        ğŸšª åŠ å…¥æˆ¿é—´
                    </button>
                </div>
                
                <div class="join-room-form hidden" id="join-room-form">
                    <div class="input-group">
                        <label for="room-code">æˆ¿é—´ä»£ç </label>
                        <input type="text" id="room-code" placeholder="è¾“å…¥6ä½æˆ¿é—´ä»£ç " maxlength="6">
                    </div>
                </div>
                
                <button class="start-btn" id="start-game-btn" onclick="startOrJoinGame()">
                    å¼€å§‹æ¸¸æˆ
                </button>
            </div>
        </div>
    </div>

    <!-- åœºæ™¯2: ç­‰å¾…æˆ¿é—´å±å¹• -->
    <div id="waiting-room-screen" class="screen hidden">
        <div class="waiting-container">
            <header class="room-header">
                <h2>ğŸ  æˆ¿é—´</h2>
                <div class="room-code-display">
                    <span>æˆ¿é—´ä»£ç : </span>
                    <span id="room-code-display" class="room-code">------</span>
                    <button onclick="copyRoomCode()" class="copy-btn">ğŸ“‹</button>
                </div>
            </header>
            
            <div class="players-waiting" id="players-waiting">
                <h3>ç­‰å¾…ç©å®¶åŠ å…¥ (<span id="player-count">0</span>/8)</h3>
                <div class="players-grid" id="waiting-players-grid">
                    <!-- åŠ¨æ€ç”Ÿæˆç­‰å¾…ä¸­çš„ç©å®¶ -->
                </div>
            </div>
            
            <div class="waiting-actions">
                <button id="start-game-host-btn" class="start-btn hidden" onclick="hostStartGame()">
                    å¼€å§‹æ¸¸æˆ
                </button>
                <div id="waiting-message" class="waiting-message">
                    ç­‰å¾…æˆ¿ä¸»å¼€å§‹æ¸¸æˆ...
                </div>
                <button onclick="leaveRoom()" class="leave-btn">
                    ç¦»å¼€æˆ¿é—´
                </button>
            </div>
        </div>
    </div>

    <!-- åœºæ™¯3: æ¸¸æˆè¿›è¡Œå±å¹• -->
    <div id="game-screen" class="screen hidden">
        <!-- æ¸¸æˆçŠ¶æ€ä¿¡æ¯ -->
        <div class="game-info">
            <div class="game-status">
                <div class="target-card-display">
                    <span>ç›®æ ‡ç‰Œ: </span>
                    <span id="target-card" class="target-card">-</span>
                </div>
                <div id="current-player" class="current-player-info">ç­‰å¾…å¼€å§‹...</div>
                <div class="game-round">
                    <span>ç¬¬ <span id="round-number">1</span> å›åˆ</span>
                </div>
            </div>
            <button onclick="showGameMenu()" class="menu-btn">â˜°</button>
        </div>
        
        <!-- å…¶ä»–ç©å®¶ä¿¡æ¯ -->
        <div class="other-players-container">
            <div class="players-grid" id="game-players-grid">
                <!-- åŠ¨æ€ç”Ÿæˆå…¶ä»–ç©å®¶ä¿¡æ¯ -->
            </div>
        </div>
        
        <!-- æ¡Œé¢åŒºåŸŸ -->
        <div class="desk-container">
            <div class="desk-info" id="desk-info">æ¡Œé¢: ç­‰å¾…å‡ºç‰Œ</div>
            <div class="desk-cards" id="desk-cards">
                <!-- åŠ¨æ€æ˜¾ç¤ºæ¡Œé¢å¡ç‰Œ -->
            </div>
        </div>
        
        <!-- æˆ‘çš„æ‰‹ç‰Œ -->
        <div class="my-hand-container">
            <div class="hand-header">
                <strong>æˆ‘çš„æ‰‹ç‰Œ</strong>
                <span id="my-hand-count">(0å¼ )</span>
            </div>
            <div id="my-hand" class="my-hand">
                <!-- åŠ¨æ€æ˜¾ç¤ºæˆ‘çš„æ‰‹ç‰Œ -->
            </div>
        </div>
        
        <!-- æ“ä½œé¢æ¿ -->
        <div class="action-panel">
            <div id="action-message" class="action-message">è¯·é€‰æ‹©å¡ç‰Œå¹¶å‡ºç‰Œ</div>
            <div class="action-buttons">
                <button id="play-cards-btn" onclick="playCards()" disabled class="play-btn">
                    å‡ºç‰Œ (0/3)
                </button>
                <button id="challenge-btn" onclick="challenge()" disabled class="challenge-btn">
                    è´¨ç–‘
                </button>
                <button id="trust-btn" onclick="trust()" disabled class="trust-btn">
                    ä¿¡ä»»
                </button>
            </div>
        </div>
    </div>

    <!-- åœºæ™¯4: æ¸¸æˆç»“æŸå±å¹• -->
    <div id="game-over-screen" class="screen hidden">
        <div class="game-over-container">
            <div id="winner-display" class="winner-display">æ¸¸æˆç»“æŸ</div>
            
            <div class="game-stats" id="game-stats">
                <!-- æ˜¾ç¤ºæ¸¸æˆç»Ÿè®¡ -->
            </div>
            
            <div class="final-ranking" id="final-ranking">
                <!-- æ˜¾ç¤ºæœ€ç»ˆæ’å -->
            </div>
            
            <div class="game-over-actions">
                <button onclick="playAgain()" class="play-again-btn">
                    å†æ¥ä¸€å±€
                </button>
                <button onclick="returnToLobby()" class="return-lobby-btn">
                    è¿”å›å¤§å…
                </button>
            </div>
        </div>
    </div>

    <!-- è½®ç›˜èµŒæ¨¡æ€æ¡† -->
    <div id="roulette-modal" class="modal hidden">
        <div class="modal-content roulette-content">
            <h2>ğŸ”« ä¿„ç½—æ–¯è½®ç›˜èµŒ</h2>
            <div id="roulette-player" class="roulette-player">ç©å®¶X æ­£åœ¨è¿›è¡Œè½®ç›˜èµŒ...</div>
            
            <div class="roulette-wheel-container">
                <div class="roulette-wheel" id="roulette-wheel">
                    <div class="wheel-chambers">
                        <div class="chamber"></div>
                        <div class="chamber"></div>
                        <div class="chamber"></div>
                        <div class="chamber"></div>
                        <div class="chamber"></div>
                        <div class="chamber"></div>
                    </div>
                    <div class="wheel-center">ğŸ”«</div>
                </div>
            </div>
            
            <div id="roulette-result" class="roulette-result"></div>
            
            <button id="spin-btn" onclick="spinRoulette()" class="spin-btn hidden">
                å¼€æª
            </button>
        </div>
    </div>

    <!-- æ¸¸æˆèœå•æ¨¡æ€æ¡† -->
    <div id="game-menu-modal" class="modal hidden">
        <div class="modal-content">
            <h3>æ¸¸æˆèœå•</h3>
            <div class="menu-options">
                <button onclick="showGameRules()" class="menu-option">
                    ğŸ“– æ¸¸æˆè§„åˆ™
                </button>
                <button onclick="showGameStats()" class="menu-option">
                    ğŸ“Š æ¸¸æˆç»Ÿè®¡
                </button>
                <button onclick="toggleSound()" class="menu-option">
                    ğŸ”Š éŸ³æ•ˆè®¾ç½®
                </button>
                <button onclick="leaveGame()" class="menu-option danger">
                    ğŸšª ç¦»å¼€æ¸¸æˆ
                </button>
            </div>
            <button onclick="closeGameMenu()" class="close-btn">å…³é—­</button>
        </div>
    </div>

    <!-- åŠ è½½æ‰€æœ‰JavaScriptæ¨¡å— -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- æ ¸å¿ƒæ¨¡å— -->
    <script src="js/socket-client.js"></script>
    <script src="js/game/GameState.js"></script>
    
    <!-- UIç»„ä»¶ -->
    <script src="js/components/Card.js"></script>
    <script src="js/components/Hand.js"></script>
    <script src="js/screens/GameScreen.js"></script>
    
    <!-- å·¥å…·æ¨¡å— -->
    <script src="js/utils/animationUtils.js"></script>
    <script src="js/utils/soundManager.js"></script>
    
    <!-- å±å¹•ç®¡ç†å™¨ -->
    <script src="js/screens/LobbyScreen.js"></script>
    
    <!-- ä¸»æ§åˆ¶å™¨ -->
    <script src="js/main.js"></script>
    
    <script>
        // å…¨å±€å˜é‡
        let currentRoomOption = 'create'; // 'create' æˆ– 'join'
        
        // æˆ¿é—´é€‰é¡¹åˆ‡æ¢
        function selectRoomOption(option) {
            currentRoomOption = option;
            
            const createBtn = document.getElementById('create-room-option');
            const joinBtn = document.getElementById('join-room-option');
            const joinForm = document.getElementById('join-room-form');
            
            if (option === 'create') {
                createBtn.classList.add('active');
                joinBtn.classList.remove('active');
                joinForm.classList.add('hidden');
            } else {
                createBtn.classList.remove('active');
                joinBtn.classList.add('active');
                joinForm.classList.remove('hidden');
            }
        }
        
        // å¼€å§‹æˆ–åŠ å…¥æ¸¸æˆ
        function startOrJoinGame() {
            const playerName = document.getElementById('player-name').value.trim();
            
            if (!playerName) {
                alert('è¯·è¾“å…¥ç©å®¶æ˜µç§°');
                return;
            }
            
            if (currentRoomOption === 'create') {
                createRoom(playerName);
            } else {
                const roomCode = document.getElementById('room-code').value.trim();
                if (!roomCode) {
                    alert('è¯·è¾“å…¥æˆ¿é—´ä»£ç ');
                    return;
                }
                joinRoom(playerName, roomCode);
            }
        }
        
        // åˆ›å»ºæˆ¿é—´
        function createRoom(playerName) {
            if (window.socketClient && window.socketClient.isConnected()) {
                window.socketClient.emit('create_room', { playerName });
            } else {
                alert('æ­£åœ¨è¿æ¥æœåŠ¡å™¨ï¼Œè¯·ç¨å...');
            }
        }
        
        // åŠ å…¥æˆ¿é—´
        function joinRoom(playerName, roomCode) {
            if (window.socketClient && window.socketClient.isConnected()) {
                window.socketClient.emit('join_room', { playerName, roomCode });
            } else {
                alert('æ­£åœ¨è¿æ¥æœåŠ¡å™¨ï¼Œè¯·ç¨å...');
            }
        }
        
        // å¤åˆ¶æˆ¿é—´ä»£ç 
        function copyRoomCode() {
            const roomCodeEl = document.getElementById('room-code-display');
            const roomCode = roomCodeEl.textContent;
            
            if (navigator.clipboard) {
                navigator.clipboard.writeText(roomCode).then(() => {
                    showToast('æˆ¿é—´ä»£ç å·²å¤åˆ¶');
                });
            } else {
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = roomCode;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('æˆ¿é—´ä»£ç å·²å¤åˆ¶');
            }
        }
        
        // æˆ¿ä¸»å¼€å§‹æ¸¸æˆ
        function hostStartGame() {
            if (window.socketClient) {
                window.socketClient.emit('start_game', {
                    roomCode: window.gameState.roomCode
                });
            }
        }
        
        // ç¦»å¼€æˆ¿é—´
        function leaveRoom() {
            if (confirm('ç¡®å®šè¦ç¦»å¼€æˆ¿é—´å—ï¼Ÿ')) {
                if (window.socketClient) {
                    window.socketClient.emit('leave_room', {
                        roomCode: window.gameState.roomCode
                    });
                }
                showScreen('lobby');
            }
        }
        
        // å±å¹•åˆ‡æ¢å‡½æ•°
        function showScreen(screenName) {
            // éšè—æ‰€æœ‰å±å¹•
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
                screen.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡å±å¹•
            const targetScreen = document.getElementById(screenName + '-screen');
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                targetScreen.classList.add('active');
            }
            
            // æ›´æ–°bodyç±»åç”¨äºæ ·å¼
            document.body.className = `screen-${screenName}`;
        }
        
        // æ˜¾ç¤ºtoastæ¶ˆæ¯
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 6px;
                color: white;
                font-size: 14px;
                z-index: 10000;
                transform: translateX(100%);
                transition: transform 0.3s ease;
                background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.style.transform = 'translateX(0)', 10);
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–æ¸¸æˆ...');
            
            // ç¡®ä¿æ˜¾ç¤ºå¤§å…å±å¹•
            showScreen('lobby');
            
            // è¯·æ±‚é€šçŸ¥æƒé™
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        });
        
        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', function(event) {
            // åœ¨å¤§å…ç•Œé¢æŒ‰Enterå¿«é€Ÿå¼€å§‹
            if (document.getElementById('lobby-screen').classList.contains('active')) {
                if (event.key === 'Enter') {
                    const playerNameInput = document.getElementById('player-name');
                    if (document.activeElement === playerNameInput && playerNameInput.value.trim()) {
                        startOrJoinGame();
                    }
                }
            }
        });
    </script>
</body>
</html>